#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Apr  5 08:20:10 2019

@author: tpoquillon
"""

import numpy as np
import Agent
import Genome

class Game:
  def __init__(self,H=8,L=100):
    #Grid
    self.Grid=np.zeros((H,L),dtype=int)
    self.Grid[H-3:H,:]=np.ones((3,L),dtype=int)
    self.Grid[:,0:2]=np.ones((H,2),dtype=int)
    self.Grid[:,L-2:L]=np.ones((H,2),dtype=int)
    #Pop
    self.Pop=[]
    #Time
    self.Time=0

  def AddAgent(self,agent):
    self.Pop.append(agent)

  """def run(self):
    self.Time+=1
    for agent in self.Pop:
      agent.Make_Decision()
      if(not(agent.Jump())):
        agent.Fall()
      agent.MvForward()
      agent.MvBackward()"""

  def MakePit(self,x):
    self.Grid[:len(self.Grid[:,x])-1,x]=np.zeros((len(self.Grid[:,x])-1),dtype=int)

  def AddBlockStratum(self,xl,xr):
    """xr>=0 and xl<L"""
    L=len(self.Grid[0])
    H=len(self.Grid)
    for col in range(xl,xr+1):
      i=0
      while i<H and self.Grid[i][col]!=1:
        i+=1
      if i!=0:
        self.Grid[i-1][col]=1
  
  def run(self):
    self.Time+=1
    for Ag in self.Pop:
      
      Ag.Make_Decision()
      if(not(Ag.Jump())):
        Ag.Fall()
      Ag.MvForward()
      Ag.MvBackward()


if __name__ == '__main__':
  g1=Game(8,30)
  print(g1.Grid==[[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])
  g2=Game(3,2)
  print(g2.Grid==[[1,1],[1,1],[1,1]])
  print(g1.Pop==g2.Pop==[])
  agent=Agent.Agent(2,2,Genome.Genome(10,4),g1)
  g1.AddAgent(agent)
  print(g1.Pop==[agent])
  print(g1.Time==g2.Time==0)
  """g1.run()
  g2.run()
  print(g1.Time==g2.Time==1)"""
  g1.MakePit(10)
  print(g1.Grid==[[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])
  g1.MakePit(29)
  print(g1.Grid==[[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])
  g1.MakePit(0)
  print(g1.Grid==[[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])
  print(g1.Grid)
  g1.AddBlockStratum(0,29)
  print(g1.Grid)
  g1.AddBlockStratum(5,12)
  print(g1.Grid)
  
  w1=Game(L=30)

  w1.MakePit(9)
  w1.MakePit(11)
  Gsucces=Genome.Genome(25,3)
  Gsucces.Set_Map(np.loadtxt("Bobby"))
  A2=Agent.Agent(4,2,Gsucces,w1.Grid)
  w1.AddAgent(A2)
  for i in range(40):
    w1.Grid[A2.posY_,A2.posX_]=2
    print(w1.Grid)
    w1.Grid[A2.posY_,A2.posX_]=0    
    input('Press <ENTER> to continue')
    w1.run()